<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kiki Moon Collection â€” Fablemarq</title>
<meta name="description" content="Continua l'avventura: acquista subito il primo libro della saga Kiki Moon e scopri i prossimi in arrivo." />
<meta name="theme-color" content="#0b1222" />

<!-- Radice asset -->
<meta name="asset-root" content="../assets" />

<link rel="icon" href="../assets/logo-fablemarq.png" />
<link rel="preload" as="image" href="../assets/it/cover1.webp" />

<!-- Font -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@800;900&family=Manrope:wght@400;700;800;900&display=swap" rel="stylesheet" />

<style>
  :root{
    --bg:#0b1222;--ink:#e9edf6;--muted:#cfd3e0;
    --gold:#E7C25F;--panel:rgba(231,194,95,.06);--panelBorder:rgba(231,194,95,.14);
    --ctaA:#FFB347;--ctaB:#FF9900;--ctaText:#111417
  }
  *{box-sizing:border-box}
  body{
    margin:0;background:var(--bg);color:var(--ink);
    font:16px/1.6 "Manrope", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    -webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;
  }
  a{text-decoration:none;color:inherit}
  .container{width:min(1100px,92vw);margin:0 auto;padding:20px 0}

  /* Header */
  header .nav{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand{flex:0 0 auto}
  .brand img{display:block;height:40px;width:auto;max-width:none;image-rendering:-webkit-optimize-contrast}

  .lang-switch{display:inline-flex;gap:6px;margin-left:14px;padding:4px 6px;border:1px solid rgba(231,194,95,.35);border-radius:14px;background:rgba(231,194,95,.10)}
  .lang-switch button{all:unset;cursor:pointer;padding:6px 10px;border-radius:10px;font-weight:700;color:#ffe8b3}
  .lang-switch button.active{background:rgba(231,194,95,.22);box-shadow:0 4px 12px rgba(231,194,95,.18)}

  /* HERO */
  .hero{
    display:grid;grid-template-columns:1fr 1.1fr;gap:20px;align-items:center;
    margin:14px 0 18px;padding:18px;border-radius:18px;
    background:var(--panel);border:1px solid var(--panelBorder);
    box-shadow:0 10px 30px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.04)
  }
  .cover-link{display:block}
  .cover-link .cover{
    display:block;aspect-ratio:2/3;border-radius:14px;object-fit:cover;width:100%;
    background:#0f1730;border:1px solid rgba(231,194,95,.16);cursor:pointer
  }
  .cover-link:hover .cover{filter:brightness(1.02)}

  .hero-title{
    text-align:center;font-weight:900;margin:0 0 8px;
    font-family:"Baloo 2", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    letter-spacing:-.2px;
  }
  .hero-title .line1{display:block;font-size:clamp(22px,4.2vw,34px);color:var(--gold)}
  .hero-title .line2{display:block;font-size:clamp(22px,4.2vw,34px);color:var(--ink)}

  .hook{
    margin:6px 0 12px;color:#ffe8b3;font-style:italic;text-align:center;
    display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden
  }

  .benefits{list-style:none;margin:8px 0 14px;padding:0;display:grid;gap:8px;justify-items:center;line-height:1.4}
  .benefits li{font-size:.98rem;color:#d8dcee;opacity:.95}
  .benefits li::before{content:"âœ“";margin-right:10px;color:var(--gold)}

  .cta{display:flex;justify-content:center;margin:12px 0 8px}
  .amazon-btn{
    display:inline-flex;align-items:center;justify-content:center;
    min-height:60px;padding:14px 28px;border-radius:12px;
    font-weight:900;font-size:1rem;letter-spacing:.2px;
    color:var(--ctaText);background:linear-gradient(180deg,var(--ctaA),var(--ctaB));border:none;
    box-shadow:0 8px 24px rgba(255,153,0,.35);transition: transform .12s ease, box-shadow .15s ease, filter .12s ease;

  }
  .amazon-btn:hover{transform:translateY(-1px);box-shadow:0 12px 30px rgba(255,153,0,.45);filter:saturate(1.05)}
  .mini-trust{margin:6px 0 12px;font-size:.92rem;color:var(--muted);text-align:center}
  .mini-trust .lock{margin-right:6px}

  .sec-title{margin:18px 0 10px;font-size:1rem;color:#cfd3e0;opacity:.9}
  .posters{display:grid;grid-template-columns:repeat(auto-fit,minmax(210px,1fr));gap:16px;list-style:none;padding:0;margin:0}
  .posters li{background:var(--panel);border:1px solid var(--panelBorder);border-radius:16px;padding:12px;text-align:center;position:relative}
  .posters img{width:100%;aspect-ratio:2/3;object-fit:cover;border-radius:12px;background:#0f1730}
  .caption{margin:8px 0 4px;font-weight:800;font-size:.95rem;color:#ffe8b3}
  .meta{margin:0;font-size:.85rem;color:#9aa3b2}

  .coming::after{
    content:"Coming Soon";
    position:absolute;top:10px;right:10px;
    font-size:.7rem;font-weight:800;
    padding:4px 8px;border-radius:999px;
    background:rgba(0,0,0,.65);color:#ffe8b3;
    text-transform:uppercase;letter-spacing:.05em;
  }
  .coming.es::after{content:"PrÃ³ximamente";}
  .coming.it::after{content:"In lavorazione";}

  .posters li.coming a.card-link{pointer-events:none;cursor:default;opacity:.9}

  /* Sticky CTA base: nascosta di default */
  .sticky-cta{
    display:none;
  }

  /* Sticky CTA mobile */
  @media (max-width:520px){
    .sticky-cta{
      position:fixed;bottom:12px;left:50%;transform:translateX(-50%);
      width:min(560px,92vw);
      background:rgba(11,18,34,.85);backdrop-filter:blur(6px);
      border:1px solid rgba(231,194,95,.18);border-radius:14px;
      padding:10px;z-index:50;
    }
    .sticky-cta .amazon-btn{width:100%}
  }
  @media (max-width:820px){
    .hero{grid-template-columns:1fr;text-align:center;gap:14px}
    .hero .cover{max-width:360px;margin:0 auto 10px}
  }
  @media (max-width:520px){
    .posters{grid-template-columns:1fr;justify-items:center}
    .posters li{width:min(420px,86vw)}
    .amazon-btn{width:100%}
  }
</style>

<script>
/* ====== asset root ====== */
const ASSET_ROOT = (()=> {
  const meta = document.querySelector('meta[name="asset-root"]');
  if (meta?.content) return meta.content.replace(/\/+$/,'');
  const p = location.pathname.toLowerCase().replace(/\\/g,'/');
  if (/(^|\/)libro-\d+\//.test(p)) return '../../assets';
  if (/(^|\/)(kikimooncollection|kiki-moon-collection|collection)\//.test(p)) return '../assets';
  return './assets';
})();

/* ====== lingua ====== */
function normLang(l){
  const s = (l||'').toLowerCase();
  if (s.startsWith('it')) return 'it';
  if (s.startsWith('es')) return 'es';
  return 'en';
}

(function initLang(){
  const qs   = new URLSearchParams(location.search);
  const urlL = qs.get('lang');
  const saved= localStorage.getItem('lang');
  const nav  = (navigator.languages && navigator.languages[0]) || navigator.language || 'en';
  const L    = normLang(urlL || saved || nav);
  document.documentElement.lang = L;
  localStorage.setItem('lang', L);
  if (urlL){
    const u = new URL(location.href);
    u.searchParams.delete('lang');
    history.replaceState({},'',u);
  }
  window.__setLang = function(newL){
    const L2 = normLang(newL);
    document.documentElement.lang = L2;
    localStorage.setItem('lang', L2);
    document.querySelectorAll('.lang-switch button')
      .forEach(b => b.classList.toggle('active', b.dataset.lang === L2));
    renderPage();
  };
})();

/* ====== store amazon ====== */
const AMZ_TLD = {IT:'it',ES:'es',FR:'fr',DE:'de',GB:'co.uk',US:'com',CA:'ca',MX:'com.mx',CO:'com.co'};

function suggestStoreFromLang(lang){
  const l = (lang || navigator.language || 'en').toLowerCase();
  if (l.includes('-ca')) return 'CA';
  if (l.includes('it'))  return 'IT';
  if (l.includes('fr'))  return 'FR';
  if (l.includes('de'))  return 'DE';
  if (l.includes('gb') || l.includes('uk')) return 'GB';
  if (l.startsWith('es')){
    if (l.includes('-mx')) return 'MX';
    if (l.includes('-co')) return 'CO';
    return 'ES';
  }
  return 'US';
}

(function initStoreOnce(){
  if (localStorage.getItem('amz_cc')) return;
  const cc = suggestStoreFromLang((navigator.languages && navigator.languages[0]) || navigator.language);
  localStorage.setItem('amz_cc', cc);
})();

/* ====== testi e asin ====== */
const I18N = {
  it:{
    heroTitle1:"Kiki Moon â€” Libro I",
    heroTitle2:"La Stella Perduta",
    heroHook:"Una stella si spegne. Ma la luce di Kiki Ã¨ appena iniziata.",
    buy:"Acquista su Amazon",
    metaBuy:"Acquisto e resi gestiti da Amazon.",
    benefits:["EtÃ  6â€“10 anni","80 pagine illustrate a colori","Ideale da leggere insieme"],
    secTitle:"Altri libri della saga",
    b1_caption:"Libro I â€” La Stella Perduta",
    b1_meta:"Lâ€™inizio dellâ€™avventura",
    b2_caption:"Libro II â€” Il Segreto di Snarfel",
    b2_meta:"In lavorazione",
    b3_caption:"Libro III â€” La Notte Infinita",
    b3_meta:"In lavorazione"
  },
  en:{
    heroTitle1:"Kiki Moon â€” Book I",
    heroTitle2:"The Lost Star",
    heroHook:"A star goes dark. Kikiâ€™s light is just beginning.",
    buy:"Buy on Amazon",
    metaBuy:"Purchase and returns handled by Amazon.",
    benefits:["Ages 6â€“10","80 full-color pages","Perfect for family reading"],
    secTitle:"Other books in the series",
    b1_caption:"Book I â€” The Lost Star",
    b1_meta:"The beginning of the journey",
    b2_caption:"Book II â€” Snarfelâ€™s Secret",
    b2_meta:"In progress",
    b3_caption:"Book III â€” The Endless Night",
    b3_meta:"In progress"
  },
  es:{
    heroTitle1:"Kiki Moon â€” Libro I",
    heroTitle2:"La Estrella Perdida",
    heroHook:"Una estrella se apaga. La luz de Kiki acaba de empezar.",
    buy:"Comprar en Amazon",
    metaBuy:"Compra y devoluciones gestionadas por Amazon.",
    benefits:["Edades 6â€“10","80 pÃ¡ginas a color","Perfecto para leer en familia"],
    secTitle:"Otros libros de la saga",
    b1_caption:"Libro I â€” La Estrella Perdida",
    b1_meta:"El inicio de la aventura",
    b2_caption:"Libro II â€” El Secreto de Snarfel",
    b2_meta:"En desarrollo",
    b3_caption:"Libro III â€” La Noche Infinita",
    b3_meta:"En desarrollo"
  }
};

const ASIN_B1 = {
  it: "B0G2MC6Z2X",
  en: "B0G2JLYKWY",
  es: "B0G2J42FDD"
};

function L(){ return localStorage.getItem('lang') || (document.documentElement.lang || 'en'); }

function buildAmazonUrl(cc, asin, lang){
  const tld = AMZ_TLD[cc] || 'com';
  const q   = new URLSearchParams();
  q.set('utm_source','qr');
  q.set('utm_medium','b1_'+lang);
  q.set('utm_campaign','readthrough');
  const src = new URLSearchParams(location.search).get('src');
  if (src) q.set('src', src);
  return `https://www.amazon.${tld}/dp/${asin}?${q.toString()}`;
}

/* ====== render ====== */
function renderPage(){
  const lang = L();
  const dict = I18N[lang] || I18N.en;

  document.querySelectorAll('.lang-switch button')
    .forEach(b => b.classList.toggle('active', b.dataset.lang === lang));

  // meta description
  const metaDesc = document.querySelector('meta[name="description"]');
  if (metaDesc){
    if (lang === 'it') metaDesc.content = "Continua l'avventura: acquista il primo libro della saga Kiki Moon e scopri i prossimi in arrivo.";
    else if (lang === 'es') metaDesc.content = "Sigue la aventura: compra el primer libro de la saga Kiki Moon y descubre los prÃ³ximos en camino.";
    else metaDesc.content = "Continue the adventure: get the first book of the Kiki Moon saga and see what's coming next.";
  }

  // hero cover
  const heroImg = document.querySelector('#hero img.cover');
  if (heroImg){
    heroImg.src = `${ASSET_ROOT}/${lang}/cover1.webp`;
    heroImg.alt = dict.heroTitle1 + " â€” " + dict.heroTitle2;
  }
  const preload = document.querySelector('link[rel="preload"][as="image"]');
  if (preload){
    preload.href = `${ASSET_ROOT}/${lang}/cover1.webp`;
  }

  // titolo hero
  const t1 = document.getElementById('titleLine1');
  const t2 = document.getElementById('titleLine2');
  if (t1) t1.textContent = dict.heroTitle1;
  if (t2) t2.textContent = dict.heroTitle2;

  // hook
  const hook = document.querySelector('[data-bind="hook"]');
  if (hook) hook.textContent = dict.heroHook;

  // benefits
  const bl = document.getElementById('benefits');
  if (bl){
    bl.innerHTML = '';
    dict.benefits.forEach(txt => {
      const li = document.createElement('li');
      li.textContent = txt;
      bl.appendChild(li);
    });
  }

  // buy text + meta
  document.querySelectorAll('[data-i18n="buy"]').forEach(el => el.textContent = dict.buy);
  const buyMeta = document.getElementById('buyMeta');
  if (buyMeta) buyMeta.innerHTML = `<span class="lock" aria-hidden="true">ðŸ”’</span> ${dict.metaBuy}`;

  // section title
  const sec = document.querySelector('.sec-title');
  if (sec) sec.textContent = dict.secTitle;

  // Amazon URL (Libro I)
  const cc   = localStorage.getItem('amz_cc') || suggestStoreFromLang(lang);
  const asin = ASIN_B1[lang] || ASIN_B1.en;
  const url  = buildAmazonUrl(cc, asin, lang);

  const mainBtn   = document.getElementById('buyNow');
  const stickyBtn = document.getElementById('buyNowSticky');
  if (mainBtn)   mainBtn.href   = url;
  if (stickyBtn) stickyBtn.href = url;

  // link anteprima Libro I
  const coverLink = document.getElementById('coverLink');
  if (coverLink){
    const u = new URL('libro-1/index.html', location.href);
    u.searchParams.set('lang', lang);
    u.searchParams.set('src', 'b1');
    u.hash = 'anteprima';
    coverLink.href = u.pathname + '?' + u.searchParams.toString() + u.hash;
  }

  // griglia libri
  const grid = document.getElementById('gridBooks');
  if (grid) {
    const b1 = grid.querySelector('li[data-book="b1"]');
    const b2 = grid.querySelector('li[data-book="b2"]');
    const b3 = grid.querySelector('li[data-book="b3"]');

    // Libro I NON deve apparire sotto se Ã¨ in hero
    if (b1) {
      b1.style.display = 'none';
    }

    // Libri successivi: â€œin lavorazioneâ€ / coming soon
    function setupComing(li, num) {
      if (!li) return;

      // classi di stato
      li.classList.add('coming');
      li.classList.remove('it', 'es');
      if (lang === 'it') li.classList.add('it');
      if (lang === 'es') li.classList.add('es');

      const img = li.querySelector('img');
      const cap = li.querySelector('.caption');
      const mt  = li.querySelector('.meta');
      const a   = li.querySelector('a.card-link');

      const caption = (num === 2 ? dict.b2_caption : dict.b3_caption);
      const meta    = (num === 2 ? dict.b2_meta    : dict.b3_meta);

      if (img) {
        img.src = `${ASSET_ROOT}/${lang}/cover${num}.webp`;
        img.alt = caption;
      }
      if (cap) cap.textContent = caption;
      if (mt)  mt.textContent  = meta;

      if (a) {
        a.removeAttribute('href');
        a.setAttribute('aria-disabled', 'true');
      }
    }

    setupComing(b2, 2);
    setupComing(b3, 3);
  }

  initStickyObserver();
}

/* sticky CTA */
function initStickyObserver(){
  const wrap = document.getElementById('stickyCta');
  const btn  = document.getElementById('buyNow');
  if (!wrap || !btn) return;
  const mq = window.matchMedia('(max-width:520px)');
  function attach(){
    if (!mq.matches){
      wrap.style.display='none';
      return;
    }
    const io = new IntersectionObserver((entries)=>{
      wrap.style.display = entries[0].isIntersecting ? 'none' : 'block';
    },{threshold:0.01});
    io.observe(btn);
  }
  if (mq.addEventListener) mq.addEventListener('change', attach);
  else mq.addListener(attach);
  attach();
}

/* bootstrap */
document.addEventListener('DOMContentLoaded', ()=>{
  const logo = document.querySelector('.brand img');
  if (logo) logo.src = `${ASSET_ROOT}/logo-fablemarq.png`;
  const fav = document.querySelector('link[rel="icon"]');
  if (fav) fav.href = `${ASSET_ROOT}/logo-fablemarq.png`;
  renderPage();
});
document.addEventListener('click',(e)=>{
  const b=e.target.closest('.lang-switch button[data-lang]');if(!b)return;
  e.preventDefault();window.__setLang&&window.__setLang(b.dataset.lang);
});
</script>
</head>
<body>
<header>
  <div class="container nav">
    <a class="brand" href="../index.html">
      <img src="../assets/logo-fablemarq.webp" alt="Fablemarq" decoding="async">
    </a>
    <nav>
      <div class="lang-switch" aria-label="Language">
        <button data-lang="en">EN</button>
        <button data-lang="it">IT</button>
        <button data-lang="es">ES</button>
      </div>
    </nav>
  </div>
</header>

<main class="container">
  <section class="hero" id="hero">
    <a id="coverLink" class="cover-link" href="#" title="Anteprima" aria-label="Apri anteprima">
      <img class="cover" src="../assets/it/cover1.webp" alt="Copertina â€” Libro I" loading="eager" />
    </a>
    <div class="copy">
      <h1 class="hero-title">
        <span class="line1" id="titleLine1">Kiki Moon â€” Libro I</span>
        <span class="line2" id="titleLine2">La Stella Perduta</span>
      </h1>
      <p class="hook" data-bind="hook">Una stella si spegne. Ma la luce di Kiki Ã¨ appena iniziata.</p>

      <ul class="benefits" id="benefits">
        <li>EtÃ  6â€“10 anni</li>
        <li>80 pagine illustrate a colori</li>
        <li>Ideale da leggere insieme</li>
      </ul>

      <div class="cta">
        <a id="buyNow" class="amazon-btn" href="#" target="_blank" rel="noopener nofollow sponsored" aria-label="Acquista su Amazon">
          <span data-i18n="buy">Acquista su Amazon</span>
        </a>
      </div>
      <p id="buyMeta" class="mini-trust">
        <span class="lock" aria-hidden="true">ðŸ”’</span>
        Acquisto e resi gestiti da Amazon.
      </p>
    </div>
  </section>

  <div class="sticky-cta" id="stickyCta">
    <a id="buyNowSticky" class="amazon-btn" href="#" target="_blank" rel="noopener nofollow sponsored" aria-label="Acquista ora su Amazon">
      <span data-i18n="buy">Acquista su Amazon</span>
    </a>
  </div>

  <h2 class="sec-title">Altri libri della saga</h2>
  <ul class="posters" id="gridBooks">
    <li data-book="b1">
      <a class="card-link" href="#"><img src="../assets/it/cover1.webp" alt="Libro I" loading="lazy"></a>
      <p class="caption">Libro I â€” La Stella Perduta</p>
      <p class="meta">Lâ€™inizio dellâ€™avventura</p>
    </li>
    <li data-book="b2">
      <a class="card-link" href="#"><img src="../assets/it/cover2.webp" alt="Libro II" loading="lazy"></a>
      <p class="caption">Libro II â€” Il Segreto di Snarfel</p>
      <p class="meta">In lavorazione</p>
    </li>
    <li data-book="b3">
      <a class="card-link" href="#"><img src="../assets/it/cover3.webp" alt="Libro III" loading="lazy"></a>
      <p class="caption">Libro III â€” La Notte Infinita</p>
      <p class="meta">In lavorazione</p>
    </li>
    <!-- Futuri, nascosti -->
    <li data-book="b4" style="display:none">
      <a class="card-link" href="#"><img src="../assets/it/cover4.webp" alt="Libro IV" loading="lazy"></a>
      <p class="caption">Libro IV</p>
      <p class="meta">Prossimamente</p>
    </li>
    <li data-book="b5" style="display:none">
      <a class="card-link" href="#"><img src="../assets/it/cover5.webp" alt="Libro V" loading="lazy"></a>
      <p class="caption">Libro V</p>
      <p class="meta">Prossimamente</p>
    </li>
    <li data-book="b6" style="display:none">
      <a class="card-link" href="#"><img src="../assets/it/cover6.webp" alt="Libro VI" loading="lazy"></a>
      <p class="caption">Libro VI</p>
      <p class="meta">Prossimamente</p>
    </li>
  </ul>
</main>
</body>
</html>
